(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{537:function(s,a,t){"use strict";t.r(a);var e=t(6),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("本教程安装软件版本为：")]),s._v(" "),t("ol",[t("li",[s._v("Kubernetes"),t("code",[s._v("1.22.0")]),s._v(" "),t("ul",[t("li",[s._v("calico 3.20")])])]),s._v(" "),t("li",[s._v("Containerd.io"),t("code",[s._v("1.4.9-3.1")])])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[s._v("关于二进制安装")]),s._v(" "),t("ul",[t("li",[s._v("kubeadm 是 Kubernetes 官方支持的安装方式，“二进制” 不是。本文档采用 kubernetes.io 官方推荐的 kubeadm 工具安装 kubernetes 集群。")])])]),t("h2",{attrs:{id:"安装前准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装前准备"}},[s._v("#")]),s._v(" 安装前准备")]),s._v(" "),t("h3",{attrs:{id:"检查服务器-所有机器均需检查"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查服务器-所有机器均需检查"}},[s._v("#")]),s._v(" 检查服务器（所有机器均需检查）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 master 节点和 worker 节点都要执行")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/redhat-release\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此处 hostname 的输出将会是该机器在 Kubernetes 集群中的节点名字")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不能使用 localhost 作为节点的名字")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请使用 lscpu 命令，核对 CPU 信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Architecture: x86_64    本安装文档不支持 arm 架构")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CPU(s):       2         CPU 内核数量不能低于 2")]),s._v("\nlscpu\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果您需要修改 hostname，可执行如下指令：")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改 hostname")]),s._v("\nhostnamectl set-hostname your-new-host-name\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看修改结果")]),s._v("\nhostnamectl status\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 hostname 解析")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1   '),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("h3",{attrs:{id:"检查网络-所有机器均需检查"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查网络-所有机器均需检查"}},[s._v("#")]),s._v(" 检查网络（所有机器均需检查）")]),s._v(" "),t("p",[s._v("在所有节点执行命令")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示服务器默认网卡")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" route show\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示默认网卡的 IP 地址")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" address\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"}),t("p",[s._v("kubelet使用的IP地址")]),s._v(" "),t("ul",[t("li",[s._v("ip route show 命令中，可以知道机器的默认网卡，通常是 eth0，如 default via 172.21.0.23 dev eth0")]),s._v(" "),t("li",[s._v("ip address 命令中，可显示默认网卡的 IP 地址，Kubernetes 将使用此 IP 地址与集群内的其他节点通信，如 172.17.216.80")]),s._v(" "),t("li",[s._v("所有节点上 Kubernetes 所使用的 IP 地址必须可以互通（无需 NAT 映射、无安全组或防火墙隔离）")])])]),t("h3",{attrs:{id:"关闭相关设置-所有机器均需检查"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关闭相关设置-所有机器均需检查"}},[s._v("#")]),s._v(" 关闭相关设置（所有机器均需检查）")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭 防火墙")]),s._v("\nsystemctl stop firewalld\nsystemctl disable firewalld\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭 SeLinux")]),s._v("\nsetenforce "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s/SELINUX=enforcing/SELINUX=disabled/g"')]),s._v(" /etc/selinux/config\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭 swap")]),s._v("\nswapoff -a\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /etc/fstab /etc/fstab_bak\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/fstab_bak "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v swap "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/fstab\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h2",{attrs:{id:"安装docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" 安装docker")]),s._v(" "),t("p",[t("strong",[s._v("所有机器均需安装")])]),s._v(" "),t("h3",{attrs:{id:"安装docker-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装docker-2"}},[s._v("#")]),s._v(" 安装docker")]),s._v(" "),t("p",[s._v("具体安装步骤见：\n"),t("RouterLink",{attrs:{to:"/blogs/docker/2021/08/docker-install.html"}},[s._v("Docker安装教程")])],1),s._v(" "),t("h3",{attrs:{id:"补充组件安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#补充组件安装"}},[s._v("#")]),s._v(" 补充组件安装")]),s._v(" "),t("p",[s._v("安装k8s还需安装docker的组件 "),t("a",{attrs:{href:"https://download.docker.com/linux/centos/7/x86_64/stable/Packages/",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载地址"),t("OutboundLink")],1)]),s._v(" "),t("ol",[t("li",[s._v("docker-ce-rootless-extras-20.10.8-3.el7.x86_64.rpm")]),s._v(" "),t("li",[s._v("docker-scan-plugin-0.8.0-3.el7.x86_64.rpm")]),s._v(" "),t("li",[s._v("fuse-overlayfs-0.7.2-6.el7_8.x86_64.rpm")]),s._v(" "),t("li",[s._v("slirp4netns-0.4.3-4.el7_8.x86_64.rpm")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在线安装，直接yum安装即可，离线安装需先下载到本地，再rpm安装")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -ivh docker-ce-rootless-extras-20.10.8-3.el7.x86_64.rpm docker-scan-plugin-0.8.0-3.el7.x86_64.rpm fuse-overlayfs-0.7.2-6.el7_8.x86_64.rpm slirp4netns-0.4.3-4.el7_8.x86_64.rpm --nodeps --force\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"将cgroup-driver修改为systemd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#将cgroup-driver修改为systemd"}},[s._v("#")]),s._v(" 将cgroup driver修改为"),t("code",[s._v("systemd")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("ul",[t("li",[t("p",[s._v("Kubernetes 推荐使用 systemd 来代替 cgroupfs，因为systemd是Kubernetes自带的cgroup管理器, 负责为每个进程分配cgroups，但docker的cgroup driver默认是cgroupfs,这样就同时运行有两个cgroup控制管理器，当资源有压力的情况时,有可能出现不稳定的情况。")])]),s._v(" "),t("li",[t("p",[s._v("故k8s与docker的cgroup driver方式需一致，不然kubeadm init时会报如下错误：")])])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('[WARNING IsDockerSystemdCheck]: detected "cgroupfs" as the Docker cgroup driver. \nThe recommended driver is "systemd". \n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),t("ol",[t("li",[s._v("查看docker当前cgroup driver")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker info\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("查询结果："),t("br"),s._v(" "),t("img",{attrs:{src:"/img/blogs/2021/08/docker-info-cgroup-driver.png",alt:"下载截图"}}),s._v("\n可以看到默认的Cgroup Driver是cgroupfs")]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("p",[s._v("修改docker的cgroup driver为systemd")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("方式一")]),t("br"),s._v("\n编辑docker的配置文件，如果不存在就创建")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/docker/daemon.json\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 内容如下")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exec-opts"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"native.cgroupdriver=systemd"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[t("strong",[s._v("方式二")]),t("br"),s._v("\n如果方式一修改后不生效的话，请使用该方式"),t("br"),s._v("\n修改docker.service文件")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/lib/systemd/system/docker.service\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在这一行后面追加配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ExecStart=/usr/bin/dockerd")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/bin/dockerd --exec-opt native.cgroupdriver"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("systemd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("重启docker")])])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("systemctl daemon-reload\nsystemctl restart docker\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("再执行"),t("code",[s._v("docker info")]),s._v("就可以看到配置已经生效了。")]),s._v(" "),t("h2",{attrs:{id:"安装containerd"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装containerd"}},[s._v("#")]),s._v(" 安装containerd")]),s._v(" "),t("p",[t("strong",[s._v("所有机器均需安装")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[s._v("Container Runtime")]),s._v(" "),t("ul",[t("li",[s._v("Kubernetes v1.21 开始，默认移除 docker 的依赖，如果宿主机上安装了 docker 和 containerd，将优先使用 docker 作为容器运行引擎，如果宿主机上未安装 docker 只安装了 containerd，将使用 containerd 作为容器运行引擎；")])])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"}),t("p",[s._v("若为内网环境需先下载好安装包，上传至服务器，本教程使用安装包为"),t("code",[s._v("containerd.io-1.4.9-3.1.el7.x86_64.rpm")]),t("br"),s._v(" "),t("a",{attrs:{href:"https://download.docker.com/linux/centos/7/x86_64/stable/Packages/",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载地址"),t("OutboundLink")],1)])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/modules-load.d/containerd.conf")]),s._v("\noverlay\nbr_netfilter\nEOF")]),s._v("\n\nmodprobe overlay\nmodprobe br_netfilter\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Setup required sysctl params, these persist across reboots.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/sysctl.d/99-kubernetes-cri.conf")]),s._v("\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.ipv4.ip_forward                 = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nEOF")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Apply sysctl params without reboot")]),s._v("\nsysctl --system\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卸载旧版本")]),s._v("\nyum remove -y containerd.io\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置 yum repository")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y yum-utils device-mapper-persistent-data lvm2\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 外网环境下")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置yum源")]),s._v("\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 containerd")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y containerd.io-1.4.9\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 内网环境下，提前下载好安装包，在安装包所在目录")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y containerd.io-1.4.9-3.1.el7.x86_64.rpm\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /etc/containerd\ncontainerd config default "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/containerd/config.toml\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s#k8s.gcr.io#registry.aliyuncs.com/k8sxio#g"')]),s._v("  /etc/containerd/config.toml\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/containerd.runtimes.runc.options/a\\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ \\ SystemdCgroup = true'")]),s._v(" /etc/containerd/config.toml\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s#https://registry-1.docker.io#'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${REGISTRY_MIRROR}")]),s._v('#g"')]),s._v("  /etc/containerd/config.toml\n\nsystemctl daemon-reload\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" containerd\nsystemctl restart containerd\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 nfs-utils")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 必须先安装 nfs-utils 才能挂载 nfs 网络存储")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y nfs-utils\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br")])]),t("h2",{attrs:{id:"安装kubelet-kubeadm-kubectl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装kubelet-kubeadm-kubectl"}},[s._v("#")]),s._v(" 安装kubelet/kubeadm/kubectl")]),s._v(" "),t("p",[t("strong",[s._v("所有机器均需安装")])]),s._v(" "),t("h3",{attrs:{id:"公网安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#公网安装"}},[s._v("#")]),s._v(" 公网安装")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置K8S的yum源")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/yum.repos.d/kubernetes.repo")]),s._v("\n[kubernetes]\nname=Kubernetes\nbaseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\n       http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卸载旧版本")]),s._v("\nyum remove -y kubelet kubeadm kubectl\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装kubelet、kubeadm、kubectl")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 ${1} 替换为 kubernetes 版本号，例如 1.20.1")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y kubelet-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${1}")]),s._v(" kubeadm-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${1}")]),s._v(" kubectl-"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${1}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h3",{attrs:{id:"离线安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#离线安装"}},[s._v("#")]),s._v(" 离线安装")]),s._v(" "),t("p",[s._v("如果是内网环境，则需现将安装包下载至本地，再上传至服务器安装。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在一台通公网的服务器执行如下命令，将kubelet kubeadm kubectl的rpm包及相关依赖下载下来并上传至服务器")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --downloadonly --downloaddir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("./ kubelet kubeadm kubectl\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卸载旧版本")]),s._v("\nyum remove -y kubelet kubeadm kubectl\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入rpm包所在目录，执行安装命令")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" *.rpm\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("下载的rpm包共10个，如图所示：\n"),t("img",{attrs:{src:"/img/blogs/2021/08/k8s-rpm.png",alt:"下载截图"}})]),s._v(" "),t("h3",{attrs:{id:"其余操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其余操作"}},[s._v("#")]),s._v(" 其余操作")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("crictl config runtime-endpoint /run/containerd/containerd.sock\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启 docker，并启动 kubelet")]),s._v("\nsystemctl daemon-reload\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kubelet "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl start kubelet\n\ncontainerd --version\nkubelet --version\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"},[s._v("WARNING")]),t("p",[s._v("如果此时执行 systemctl status kubelet 命令，将得到 kubelet 启动失败的错误提示，请忽略此错误，因为必须完成后续步骤中 kubeadm init 的操作，kubelet 才能正常启动")])]),t("h2",{attrs:{id:"初始化master节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化master节点"}},[s._v("#")]),s._v(" 初始化master节点")]),s._v(" "),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"title"},[s._v("关于初始化时用到的环境变量")]),t("ul",[t("li",[s._v("APISERVER_NAME 不能是 master 的 hostname")]),s._v(" "),t("li",[s._v("APISERVER_NAME 必须全为小写字母、数字、小数点，不能包含减号")]),s._v(" "),t("li",[s._v("POD_SUBNET 所使用的网段不能与 master节点/worker节点 所在的网段重叠。该字段的取值为一个 CIDR 值，如果您对 CIDR 这个概念还不熟悉，请仍然执行 export POD_SUBNET=10.100.0.0/16 命令，不做修改")])])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只在 master 节点执行")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 替换 x.x.x.x 为 master 节点的内网IP")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# export 命令只在当前 shell 会话中有效，开启新的 shell 窗口后，如果要继续安装过程，请重新执行此处的 export 命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MASTER_IP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("x.x.x.x\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 替换 apiserver.demo 为 您想要的 dnsName")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("APISERVER_NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("apiserver.demo\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Kubernetes 容器组所在的网段，该网段安装完成后，由 kubernetes 创建，事先并不存在于您的物理网络中")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("POD_SUBNET")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.100")]),s._v(".0.0/16\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${MASTER_IP}")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${APISERVER_NAME}")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("font",{attrs:{color:"#dd0000"}},[s._v("\n请将脚本第21行的 ${1} 替换成您需要的版本号，例如 1.22.0  \n若为离线安装，31行的版本号修改为需要的coredns镜像版本号\n")]),s._v(" "),t("p",[s._v("创建一个脚本文件，内容如下：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只在 master 节点执行")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 脚本出错时终止执行")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -e\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("POD_SUBNET}")]),s._v(" -eq "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("#")]),s._v("APISERVER_NAME}")]),s._v(" -eq "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[s._v("\\033")]),s._v("[31;1m请确保您已经设置了环境变量 POD_SUBNET 和 APISERVER_NAME "),t("span",{pre:!0,attrs:{class:"token entity",title:"\\033"}},[s._v("\\033")]),s._v('[0m"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" 当前POD_SUBNET"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$POD_SUBNET")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" 当前APISERVER_NAME"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$APISERVER_NAME")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看完整配置选项 https://godoc.org/k8s.io/kubernetes/cmd/kubeadm/app/apis/kubeadm/v1beta2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f ./kubeadm-config.yaml\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ./kubeadm-config.yaml")]),s._v("\n---\napiVersion: kubeadm.k8s.io/v1beta2\nkind: ClusterConfiguration\nkubernetesVersion: v"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${1}")]),s._v('\nimageRepository: registry.aliyuncs.com/k8sxio\ncontrolPlaneEndpoint: "'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${APISERVER_NAME}")]),s._v(':6443"\nnetworking:\n  serviceSubnet: "10.96.0.0/16"\n  podSubnet: "'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${POD_SUBNET}")]),s._v('"\n  dnsDomain: "cluster.local"\ndns:\n  type: CoreDNS\n  imageRepository: registry.aliyuncs.com/k8sxio\n  imageTag: 1.8.4\n\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nkind: KubeletConfiguration\ncgroupDriver: systemd\nEOF')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm init")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据您服务器网速的情况，您需要等候 3 - 10 分钟")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 抓取镜像步骤可忽略，离线安装方式必须忽略")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"抓取镜像，请稍候..."')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm config images pull --config=kubeadm-config.yaml")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"初始化 Master 节点"')]),s._v("\nkubeadm init --config"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubeadm-config.yaml --upload-certs\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置 kubectl")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf /root/.kube/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /root/.kube/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -i /etc/kubernetes/admin.conf /root/.kube/config\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br")])]),t("h3",{attrs:{id:"在线安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在线安装"}},[s._v("#")]),s._v(" 在线安装")]),s._v(" "),t("p",[s._v("执行上述脚本文件即可")]),s._v(" "),t("h3",{attrs:{id:"离线安装-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#离线安装-2"}},[s._v("#")]),s._v(" 离线安装")]),s._v(" "),t("p",[s._v("由于离线，无法从镜像仓库获取所需要的镜像，故需要先从本地将镜像下载下来并导入到服务器的docker中，再执行脚本。")]),s._v(" "),t("ol",[t("li",[s._v("获取所需要镜像及版本名称")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubeadm config images list\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("所需镜像列表如下："),t("br"),s._v(" "),t("img",{attrs:{src:"/img/blogs/2021/08/k8s-master-init-images.png",alt:"镜像列表"}})]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[s._v("在本地将镜像pull下来")])]),s._v(" "),t("ul",[t("li",[s._v("版本需要续上一步操作查询出来的版本对应")]),s._v(" "),t("li",[s._v("上一步查询的镜像源"),t("code",[s._v("k8s.grc.io")]),s._v("由于在国外，无法直接下载，故我们替换为国内镜像源"),t("code",[s._v("registry.cn-hangzhou.aliyuncs.com/google_containers")])])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.22.0\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.22.0\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.22.0\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.22.0\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.5\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.5.0-0\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.8.4\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("将镜像导出为tar包，上传至服务器，并导入")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据镜像名或镜像id将镜像导出到本地，格式为tar")]),s._v("\ndocker save 镜像ID "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 名称.tar\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在服务器上将镜像导入docker")]),s._v("\ndocker load "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" 名称.tar\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("修改镜像名称与标签"),t("br"),s._v("\n导入的镜像仓库名与tag需要与之前步骤中查询所需镜像名称与tag一致，同时所属库需修改为脚本中配置的，本教程为"),t("code",[s._v("registry.aliyuncs.com/k8sxio")])])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改镜像名称与tag")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如 docker tag 838d692cbe28 registry.aliyuncs.com/k8sxio/kube-apiserver:v1.22.0")]),s._v("\ndocker tag 镜像id 镜像名称:tag\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除多余或无用镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如 docker rmi 838d692cbe28 或 docker rmi registry.aliyuncs.com/k8sxio/kube-apiserver:v1.22.0")]),s._v("\ndocker rmi 镜像id/镜像仓库名\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导入并修改完成后查看当前本地镜像列表")]),s._v("\ndocker images\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("导入完成后，查询结果如图："),t("br"),s._v(" "),t("img",{attrs:{src:"/img/blogs/2021/08/docker-images-list.png",alt:"镜像列表"}})]),s._v(" "),t("ol",{attrs:{start:"5"}},[t("li",[s._v("执行上述脚本文件对master进行初始化\n此时执行，发现本地有所需要的镜像，就不会从网上pull了。")])]),s._v(" "),t("p",[s._v("初始化成功后会看到如下信息，请保存好，后续步骤中会用到"),t("br"),s._v(" "),t("img",{attrs:{src:"/img/blogs/2021/08/k8s-master-init-result.png",alt:"镜像列表"}})]),s._v(" "),t("h3",{attrs:{id:"检查master初始化结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查master初始化结果"}},[s._v("#")]),s._v(" 检查master初始化结果")]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"title"}),t("p",[t("code",[s._v("coredns")]),s._v(" 将处于启动失败的状态，请继续下一步，完成 "),t("a",{attrs:{href:"#install-network-plugin",title:"安装网络插件"}},[s._v("安装网络插件")]),s._v(" 这个步骤后，coredns 将正常启动。")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只在 master 节点执行")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行如下命令，等待 3-10 分钟，直到所有的容器组处于 Running 状态")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" kubectl get pod -n kube-system -o wide\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 master 节点初始化结果")]),s._v("\nkubectl get nodes -o wide\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("span",{attrs:{id:"install-network-plugin"}}),s._v(" "),t("h2",{attrs:{id:"安装网络插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装网络插件"}},[s._v("#")]),s._v(" 安装网络插件")]),s._v(" "),t("p",[s._v("Calico是一个纯三层网络，通过linux 内核的L3 forwarding来实现vRouter功能，区别于fannel等需要封包解包的网络协议。")]),s._v(" "),t("h3",{attrs:{id:"下载calico镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载calico镜像"}},[s._v("#")]),s._v(" 下载Calico镜像")]),s._v(" "),t("p",[s._v("若可联网，可直接从线上pull镜像，离线环境下，需先下载到本地，再上传至服务器。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker pull calico/node:v3.20.0 \ndocker pull calico/cni:v3.20.0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"安装calico"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装calico"}},[s._v("#")]),s._v(" 安装Calico")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新版的calico已将rbac配置信息整合在calico.yaml中")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在线环境直接执行curl获取calico.yaml，离线环境需要在本地访问此地址下载并上传至服务器，再执行后续操作")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" https://docs.projectcalico.org/v3.20/manifests/calico.yaml -O\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("POD_SUBNET")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.100.0.0/16"')]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s?192.168.0.0/16?'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$POD_SUBNET")]),s._v('?g"')]),s._v(" calico.yaml\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s?typha_service_name: '),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("none"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("?typha_service_name: "),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("calico-typha"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v('?g"')]),s._v(" calico.yaml\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s?replicas: 1?replicas: 2?g"')]),s._v(" calico.yaml\n\nkubectl apply -f calico.yaml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"确认calico安装情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#确认calico安装情况"}},[s._v("#")]),s._v(" 确认Calico安装情况")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl get pods --all-namespaces\nkubectl get nodes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"初始化worker节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化worker节点"}},[s._v("#")]),s._v(" 初始化worker节点")]),s._v(" "),t("h3",{attrs:{id:"获得-join命令参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获得-join命令参数"}},[s._v("#")]),s._v(" 获得 join命令参数")]),s._v(" "),t("p",[t("strong",[s._v("在 master 节点上执行")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只在 master 节点执行")]),s._v("\nkubeadm token create --print-join-command\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("可获取kubeadm join 命令及参数，如下所示")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm token create 命令的输出")]),s._v("\nkubeadm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" apiserver.demo:6443 --token mpfjma.4vjjg8flqihor4vt     --discovery-token-ca-cert-hash sha256:6f7a8e40a810323672de5eee6f4d19aa2dbdb38411845a1bf5dd63485c43d303\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"},[s._v("有效时间")]),t("p",[s._v("该 token 的有效时间为 2 个小时，2小时内，您可以使用此 token 初始化任意数量的 worker 节点。")])]),t("h3",{attrs:{id:"初始化worker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化worker"}},[s._v("#")]),s._v(" 初始化worker")]),s._v(" "),t("p",[t("strong",[s._v("针对所有的 worker 节点执行")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只在 worker 节点执行")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 替换 x.x.x.x 为 master 节点的内网 IP")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MASTER_IP")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("x.x.x.x\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 替换 apiserver.demo 为初始化 master 节点时所使用的 APISERVER_NAME")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("APISERVER_NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("apiserver.demo\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${MASTER_IP}")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${APISERVER_NAME}")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 替换为 master 节点上 kubeadm token create 命令的输出")]),s._v("\nkubeadm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" apiserver.demo:6443 --token mpfjma.4vjjg8flqihor4vt     --discovery-token-ca-cert-hash sha256:6f7a8e40a810323672de5eee6f4d19aa2dbdb38411845a1bf5dd63485c43d303\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"检查初始化结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查初始化结果"}},[s._v("#")]),s._v(" 检查初始化结果")]),s._v(" "),t("p",[t("strong",[s._v("在master节点上执行")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只在 master 节点执行")]),s._v("\nkubectl get nodes -o wide\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("输出结果如下所示："),t("br"),s._v(" "),t("img",{attrs:{src:"/img/blogs/2021/08/k8s-work-init-result.png",alt:"镜像列表"}})]),s._v(" "),t("p",[s._v("至此，Kubernetes（单Master节点）就安装完成了")]),s._v(" "),t("h2",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://kuboard.cn/install/install-k8s.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://kuboard.cn/install/install-k8s.html"),t("OutboundLink")],1)])],1)}),[],!1,null,null,null);a.default=n.exports}}]);