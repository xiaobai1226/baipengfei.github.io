(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{548:function(s,a,e){"use strict";e.r(a);var t=e(6),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"jenkins介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jenkins介绍"}},[s._v("#")]),s._v(" Jenkins介绍")]),s._v(" "),e("p",[s._v("Jenkins是开源软件项目，基于Java开发的持续集成工具，用于监控持续重复的工作，旨在提供一个开放易用的软件平台，使软件的持续集成变成可能。")]),s._v(" "),e("h2",{attrs:{id:"前期准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前期准备"}},[s._v("#")]),s._v(" 前期准备")]),s._v(" "),e("ol",[e("li",[s._v("安装Helm")]),s._v(" "),e("li",[s._v("安装k8s")]),s._v(" "),e("li",[s._v("安装cpeh")])]),s._v(" "),e("h2",{attrs:{id:"安装jenkins"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装jenkins"}},[s._v("#")]),s._v(" 安装Jenkins")]),s._v(" "),e("h3",{attrs:{id:"_1-添加jenkins仓库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-添加jenkins仓库"}},[s._v("#")]),s._v(" 1. 添加Jenkins仓库：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增加Jenkins源")]),s._v("\nhelm repo "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" jenkins https://charts.jenkins.io\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新Helm")]),s._v("\nhelm repo update\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_2-搜索可用的jenkins版本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-搜索可用的jenkins版本"}},[s._v("#")]),s._v(" 2. 搜索可用的Jenkins版本")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("helm search repo jenkins\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_3-将jenkins的chart包下载到本地"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-将jenkins的chart包下载到本地"}},[s._v("#")]),s._v(" 3. 将Jenkins的chart包下载到本地")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("helm fetch jenkins/jenkins\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_4-解压文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-解压文件"}},[s._v("#")]),s._v(" 4. 解压文件")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压文件")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xvf jenkins-3.8.8.tgz\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压完成后进入目录")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" jenkins\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_5-按需修改配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-按需修改配置文件"}},[s._v("#")]),s._v(" 5. 按需修改配置文件")]),s._v(" "),e("p",[s._v("修改配置文件values.yaml，我改了以下几处")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 使用storageClass")]),s._v("\nstorageClass: rook-cephfs\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 注释掉插件下载，否则可能会很慢，待安装完成后，手动安装插件")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# List of plugins to be install during Jenkins controller start")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#installPlugins:")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  - kubernetes:1.30.1")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  - workflow-aggregator:2.6")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  - git:4.9.0")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  - configuration-as-code:1.53")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 改为NodePort模式")]),s._v("\nserviceType: NodePort\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("其中"),e("code",[s._v("rook-cephfs")]),s._v("是预先创建好的storageClass")]),s._v(" "),e("h3",{attrs:{id:"_6-部署jenkins"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-部署jenkins"}},[s._v("#")]),s._v(" 6. 部署Jenkins")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("helm "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" jenkins ./ -f values.yaml --namespace jenkins\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("此时就已安装完成了")]),s._v(" "),e("h2",{attrs:{id:"登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#登录"}},[s._v("#")]),s._v(" 登录")]),s._v(" "),e("h3",{attrs:{id:"_1-获取初始密码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-获取初始密码"}},[s._v("#")]),s._v(" 1. 获取初始密码")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get secret --namespace jenkins jenkins -o "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.data.jenkins-admin-password}"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64 --decode"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"_2-页面登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-页面登录"}},[s._v("#")]),s._v(" 2. 页面登录")]),s._v(" "),e("p",[s._v("由于选择了NodePort模式，并且未指定nodeport端口，查看后k8s自动分配了32148端口。此时，使用"),e("code",[s._v("http://10.169.136.38:32148")]),s._v("即可登录web管理页面进行使用。")]),s._v(" "),e("h3",{attrs:{id:"_3-禁用允许用户匿名登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-禁用允许用户匿名登录"}},[s._v("#")]),s._v(" 3. 禁用允许用户匿名登录")]),s._v(" "),e("p",[s._v("使用这种方式安装后，首次进入页面可以发现，直接可以使用，为了安全起见将用户匿名登录禁用。"),e("br"),s._v("\n按下图所示修改即可\n"),e("img",{attrs:{src:"/img/blogs/2021/11/k8s-jenkins-close-anonymous.png",alt:"文件截图"}}),s._v("\n修改后，创建新用户使用即可。")]),s._v(" "),e("h2",{attrs:{id:"安装插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装插件"}},[s._v("#")]),s._v(" 安装插件")]),s._v(" "),e("p",[s._v("将文中开头注释的插件及自己需要的插件一一安装即可，此处不再详细赘述。")]),s._v(" "),e("h2",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1807943",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://cloud.tencent.com/developer/article/1807943"),e("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);